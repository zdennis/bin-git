#!/usr/bin/env bash

VERSION="1.0.0"
SCRIPT_NAME="git-build-go-helpers"

show_help() {
  cat << EOF
$SCRIPT_NAME - Build and install go helper commands

Usage: $SCRIPT_NAME [options]

Options:
  -h, --help     Show this help message
  -v, --version  Show version information

Description:
  Builds and installs go-based git helper commands from the go-commands
  directory (relative to this script's location).

Examples:
  # Build and install go helpers
  $SCRIPT_NAME

Version: $VERSION
EOF
}

case "$1" in
  -h|--help)
    show_help
    exit 0
    ;;
  -v|--version)
    echo "$SCRIPT_NAME version $VERSION"
    exit 0
    ;;
esac

set -e

error_exit() {
  printf "\033[1;91mError:\033[0m %s\n" "$1" >&2
  exit 1
}

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TARGET_DIR="$SCRIPT_DIR/../go-commands"

if [ ! -d "$TARGET_DIR" ]; then
  error_exit "Directory '$TARGET_DIR' not found!"
fi

cd "$TARGET_DIR"

trap 'error_exit "An unexpected error occurred in $TARGET_DIR."' ERR

echo "Building go commands..."
./build-all

echo "Installing go commands..."
./install
