#!/usr/bin/env bash

VERSION="1.0.0"
SCRIPT_NAME="git-rubocop-branch"

show_help() {
  cat << EOF
$SCRIPT_NAME - Run rubocop on files changed in branch

Usage: $SCRIPT_NAME [options]

Options:
  -h, --help     Show this help message
  -v, --version  Show version information

Description:
  Runs rubocop on all files that have been added or modified in the
  current branch compared to main. Excludes deleted and renamed files.

Examples:
  # Run rubocop on changed files
  $SCRIPT_NAME

Version: $VERSION
EOF
}

case "$1" in
  -h|--help)
    show_help
    exit 0
    ;;
  -v|--version)
    echo "$SCRIPT_NAME version $VERSION"
    exit 0
    ;;
esac

main_branch=$(git get-main-branch 2>/dev/null)
if [ -z "$main_branch" ]; then
  echo "Error: Could not determine main branch" >&2
  exit 1
fi

changed_files=$(git diff --name-status "$main_branch..HEAD" | grep -vE '^(D|R)' | cut -f2)
if [ -z "$changed_files" ]; then
  echo "No changed files to check"
  exit 0
fi

echo "$changed_files" | xargs bundle exec rubocop
