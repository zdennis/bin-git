#!/usr/bin/env bash

VERSION="1.0.0"
SCRIPT_NAME="git-fixup"

show_help() {
  cat << EOF
$SCRIPT_NAME - Create a fixup commit for a previous commit

Usage: $SCRIPT_NAME [options] <sha>

Options:
  -h, --help     Show this help message
  -v, --version  Show version information

Arguments:
  sha            The commit SHA to create a fixup for (required)

Description:
  Creates a fixup commit that will be automatically squashed into the
  specified commit during an interactive rebase with --autosquash.

Examples:
  # Create fixup commit for a specific SHA
  $SCRIPT_NAME abc1234

  # Workflow: stage changes, create fixup, then rebase
  git add file.txt
  $SCRIPT_NAME abc1234
  git rebase -i --autosquash main

Version: $VERSION
EOF
}

case "$1" in
  -h|--help)
    show_help
    exit 0
    ;;
  -v|--version)
    echo "$SCRIPT_NAME version $VERSION"
    exit 0
    ;;
esac

SHA="$1"

if [ -z "$SHA" ]; then
  printf "\e[31mError: You must pass a SHA to fixup.\e[0m\n" >&2
  printf "Usage: $SCRIPT_NAME <sha>\n" >&2
  printf "Run '$SCRIPT_NAME --help' for more information.\n" >&2
  exit 1
fi

# Verify the SHA exists
if ! git rev-parse --verify "$SHA^{commit}" > /dev/null 2>&1; then
  printf "\e[31mError: Invalid commit SHA: %s\e[0m\n" "$SHA" >&2
  exit 1
fi

git commit --fixup="$SHA"
